(()=>{"use strict";const e=window.wp.element,n=window.ReactJSXRuntime,o=({title:e,subtitle:o,apiBase:s})=>{const[a,i]=React.useState(1),[l,t]=React.useState([]),[c,r]=React.useState(null),[d,m]=React.useState([]),[_,h]=React.useState(null),[k,b]=React.useState(!1),[v,j]=React.useState(null),[g,p]=React.useState(null),[x,u]=React.useState({name:"",email:"",phone:"",company:"",topic:"",marketing_consent:!1,terms_consent:!1});React.useEffect(()=>{N()},[]);const N=async()=>{b(!0),j(null);try{const e=await fetch(`${s}/available-slots`),n=await e.json();t(n.availableDates||[])}catch(e){j("Nie udało się pobrać dostępnych terminów. Spróbuj ponownie.")}finally{b(!1)}},y=async e=>{b(!0),j(null);try{const n=await fetch(`${s}/available-slots?date=${e}`),o=await n.json();m(o.slots?.filter(e=>e.available)||[])}catch(e){j("Nie udało się pobrać wolnych godzin. Spróbuj ponownie.")}finally{b(!1)}},w=e=>{const{name:n,value:o,type:s,checked:a}=e.target;u(e=>({...e,[n]:"checkbox"===s?a:o}))},z=()=>(0,n.jsx)("svg",{className:"nevo-booking__icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),f=()=>(0,n.jsx)("svg",{className:"nevo-booking__icon-md",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),C=()=>(0,n.jsx)("svg",{className:"nevo-booking__icon-lg",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),S=()=>(0,n.jsx)("svg",{className:"nevo-booking__icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})});return(0,n.jsxs)("div",{className:"nevo-booking",children:[(0,n.jsxs)("div",{className:"nevo-booking__header",children:[(0,n.jsx)("h2",{className:"nevo-booking__title",children:e}),(0,n.jsx)("p",{className:"nevo-booking__subtitle",children:o})]}),a<4&&(0,n.jsx)("div",{className:"nevo-booking__progress",children:[1,2,3].map(e=>(0,n.jsx)("div",{className:"nevo-booking__progress-dot "+(e===a?"nevo-booking__progress-dot--active":e<a?"nevo-booking__progress-dot--done":"")},e))}),v&&(0,n.jsx)("div",{className:"nevo-booking__error",children:v}),1===a&&(0,n.jsxs)("div",{className:"nevo-booking__step",children:[(0,n.jsx)("h3",{className:"nevo-booking__step-title",children:"Wybierz dzień"}),k?(0,n.jsx)("div",{className:"nevo-booking__loader",children:(0,n.jsx)("div",{className:"nevo-booking__spinner"})}):(0,n.jsx)("div",{className:"nevo-booking__dates",children:l.map(e=>(0,n.jsxs)("button",{onClick:()=>(e=>{r(e),h(null),y(e.date),i(2)})(e),className:"nevo-booking__date-btn",children:[(0,n.jsx)("span",{className:"nevo-booking__date-day",children:e.dayShort}),(0,n.jsx)("span",{className:"nevo-booking__date-num",children:e.dayOfMonth}),(0,n.jsx)("span",{className:"nevo-booking__date-month",children:e.month})]},e.date))})]}),2===a&&(0,n.jsxs)("div",{className:"nevo-booking__step",children:[(0,n.jsxs)("button",{onClick:()=>i(1),className:"nevo-booking__back-btn",children:[(0,n.jsx)(z,{})," Zmień dzień"]}),(0,n.jsx)("h3",{className:"nevo-booking__step-title",children:"Wybierz godzinę"}),(0,n.jsxs)("p",{className:"nevo-booking__step-info",children:[c?.dayName,", ",c?.dayOfMonth," ",c?.month]}),k?(0,n.jsx)("div",{className:"nevo-booking__loader",children:(0,n.jsx)("div",{className:"nevo-booking__spinner"})}):0===d.length?(0,n.jsxs)("div",{className:"nevo-booking__empty",children:["Brak wolnych terminów w tym dniu.",(0,n.jsx)("button",{onClick:()=>i(1),className:"nevo-booking__link",children:"Wybierz inny dzień"})]}):(0,n.jsx)("div",{className:"nevo-booking__slots",children:d.map(e=>(0,n.jsx)("button",{onClick:()=>(e=>{h(e),i(3)})(e),className:"nevo-booking__slot-btn",children:e.time},e.time))})]}),3===a&&(0,n.jsxs)("div",{className:"nevo-booking__step",children:[(0,n.jsxs)("button",{onClick:()=>i(2),className:"nevo-booking__back-btn",children:[(0,n.jsx)(z,{})," Zmień godzinę"]}),(0,n.jsxs)("div",{className:"nevo-booking__selected",children:[(0,n.jsx)("div",{className:"nevo-booking__selected-icon",children:(0,n.jsx)(f,{})}),(0,n.jsxs)("div",{className:"nevo-booking__selected-info",children:[(0,n.jsxs)("div",{className:"nevo-booking__selected-date",children:[c?.dayName,", ",c?.dayOfMonth," ",c?.month]}),(0,n.jsx)("div",{className:"nevo-booking__selected-time",children:_?.time})]})]}),(0,n.jsx)("h3",{className:"nevo-booking__step-title",children:"Twoje dane"}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),b(!0),j(null);try{const e=await fetch(`${s}/book-consultation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...x,date:c.date,time:_.time})}),n=await e.json();n.success?(p(n.booking),i(4)):(j(n.message||"Wystąpił błąd podczas rezerwacji."),"SLOT_TAKEN"===n.error&&(y(c.date),i(2)))}catch(e){j("Nie udało się dokonać rezerwacji. Spróbuj ponownie.")}finally{b(!1)}},className:"nevo-booking__form",children:[(0,n.jsxs)("div",{className:"nevo-booking__field",children:[(0,n.jsx)("label",{className:"nevo-booking__label",children:"Imię i nazwisko *"}),(0,n.jsx)("input",{type:"text",name:"name",value:x.name,onChange:w,required:!0,className:"nevo-booking__input",placeholder:"Jan Kowalski"})]}),(0,n.jsxs)("div",{className:"nevo-booking__field",children:[(0,n.jsx)("label",{className:"nevo-booking__label",children:"Email *"}),(0,n.jsx)("input",{type:"email",name:"email",value:x.email,onChange:w,required:!0,className:"nevo-booking__input",placeholder:"jan@firma.pl"})]}),(0,n.jsxs)("div",{className:"nevo-booking__field",children:[(0,n.jsx)("label",{className:"nevo-booking__label",children:"Telefon *"}),(0,n.jsx)("input",{type:"tel",name:"phone",value:x.phone,onChange:w,required:!0,className:"nevo-booking__input",placeholder:"+48 123 456 789"})]}),(0,n.jsxs)("div",{className:"nevo-booking__field",children:[(0,n.jsx)("label",{className:"nevo-booking__label",children:"Firma (opcjonalnie)"}),(0,n.jsx)("input",{type:"text",name:"company",value:x.company,onChange:w,className:"nevo-booking__input",placeholder:"Nazwa firmy"})]}),(0,n.jsxs)("div",{className:"nevo-booking__field",children:[(0,n.jsx)("label",{className:"nevo-booking__label",children:"O czym chcesz porozmawiać?"}),(0,n.jsx)("textarea",{name:"topic",value:x.topic,onChange:w,rows:3,className:"nevo-booking__textarea",placeholder:"Krótko opisz temat rozmowy..."})]}),(0,n.jsxs)("div",{className:"nevo-booking__consents",children:[(0,n.jsxs)("label",{className:"nevo-booking__checkbox",children:[(0,n.jsx)("input",{type:"checkbox",name:"marketing_consent",checked:x.marketing_consent,onChange:w,required:!0}),(0,n.jsx)("span",{children:"Wyrażam zgodę na kontakt marketingowy od NEVO *"})]}),(0,n.jsxs)("label",{className:"nevo-booking__checkbox",children:[(0,n.jsx)("input",{type:"checkbox",name:"terms_consent",checked:x.terms_consent,onChange:w,required:!0}),(0,n.jsxs)("span",{children:["Akceptuję ",(0,n.jsx)("a",{href:"/regulamin",children:"regulamin"})," i ",(0,n.jsx)("a",{href:"/polityka-prywatnosci",children:"politykę prywatności"})," *"]})]})]}),(0,n.jsx)("button",{type:"submit",disabled:k,className:"nevo-booking__submit",children:k?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"nevo-booking__spinner nevo-booking__spinner--small"}),"Rezerwuję..."]}):"Zarezerwuj konsultację"})]})]}),4===a&&(0,n.jsxs)("div",{className:"nevo-booking__step nevo-booking__step--center",children:[(0,n.jsx)("div",{className:"nevo-booking__success-icon",children:(0,n.jsx)(C,{})}),(0,n.jsx)("h3",{className:"nevo-booking__success-title",children:"Rezerwacja potwierdzona!"}),(0,n.jsxs)("p",{className:"nevo-booking__success-text",children:["Wysłaliśmy potwierdzenie na ",g?.email]}),(0,n.jsxs)("div",{className:"nevo-booking__summary",children:[(0,n.jsxs)("div",{className:"nevo-booking__summary-row",children:[(0,n.jsx)("span",{children:"Data:"}),(0,n.jsx)("strong",{children:g?.formattedDate})]}),(0,n.jsxs)("div",{className:"nevo-booking__summary-row",children:[(0,n.jsx)("span",{children:"Godzina:"}),(0,n.jsx)("strong",{children:g?.time})]}),(0,n.jsxs)("div",{className:"nevo-booking__summary-row",children:[(0,n.jsx)("span",{children:"Czas trwania:"}),(0,n.jsx)("strong",{children:"30 minut"})]}),g?.meetLink&&(0,n.jsxs)("a",{href:g.meetLink,target:"_blank",rel:"noopener noreferrer",className:"nevo-booking__meet-btn",children:[(0,n.jsx)(S,{}),"Dołącz do Google Meet"]})]}),(0,n.jsx)("p",{className:"nevo-booking__note",children:"Link do spotkania znajdziesz również w zaproszeniu kalendarzowym."}),(0,n.jsx)("button",{onClick:()=>{i(1),r(null),h(null),p(null),u({name:"",email:"",phone:"",company:"",topic:"",marketing_consent:!1,terms_consent:!1}),N()},className:"nevo-booking__link",children:"Zarezerwuj kolejne spotkanie"})]}),(0,n.jsx)("div",{className:"nevo-booking__footer",children:(0,n.jsx)("p",{children:"Odpowiemy w ciągu 24 godzin • Video call przez Google Meet"})})]})};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".nevo-booking-calendar").forEach(s=>{const a=s.dataset.title||"Umów bezpłatną konsultację",i=s.dataset.subtitle||"30 minut rozmowy o Twoim biznesie. Bez zobowiązań.",l=s.dataset.apiBase||"https://n8n.nevomarketing.pl/webhook";(0,e.createRoot)(s).render((0,n.jsx)(o,{title:a,subtitle:i,apiBase:l}))})})})();