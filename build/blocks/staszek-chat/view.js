(()=>{"use strict";const e=window.wp.element,s=window.ReactJSXRuntime,a=({apiEndpoint:e,bookingUrl:a,welcomeMessage:t,position:n})=>{const[i,l]=React.useState(!1),[c,o]=React.useState([{role:"assistant",content:t}]),[r,d]=React.useState(""),[m,z]=React.useState(!1),u=React.useRef(null),k=React.useRef(null);React.useEffect(()=>{u.current?.scrollIntoView({behavior:"smooth"})},[c]),React.useEffect(()=>{i&&k.current&&k.current.focus()},[i]);const h="bottom-left"===n?"staszek-chat--left":"";return(0,s.jsxs)(s.Fragment,{children:[!i&&(0,s.jsxs)("button",{onClick:()=>l(!0),className:"staszek-bubble "+("bottom-left"===n?"staszek-bubble--left":""),"aria-label":"Otwórz czat ze Staszkiem",children:[(0,s.jsx)("div",{className:"staszek-bubble__avatar",children:"S"}),(0,s.jsxs)("div",{className:"staszek-bubble__text",children:[(0,s.jsx)("span",{className:"staszek-bubble__name",children:"Staszek"}),(0,s.jsx)("span",{className:"staszek-bubble__status",children:"Odpowiem w kilka sekund"})]})]}),i&&(0,s.jsxs)("div",{className:`staszek-chat ${h}`,children:[(0,s.jsxs)("div",{className:"staszek-header",children:[(0,s.jsxs)("div",{className:"staszek-header__info",children:[(0,s.jsx)("div",{className:"staszek-header__avatar",children:"S"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"staszek-header__name",children:"Staszek"}),(0,s.jsxs)("div",{className:"staszek-header__status",children:[(0,s.jsx)("span",{className:"staszek-header__dot"}),"Asystent NEVO"]})]})]}),(0,s.jsx)("button",{onClick:()=>l(!1),className:"staszek-header__close","aria-label":"Zamknij czat",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"staszek-messages",children:[c.map((e,a)=>(0,s.jsxs)("div",{className:`staszek-message staszek-message--${e.role}`,children:["assistant"===e.role&&(0,s.jsx)("div",{className:"staszek-message__avatar",children:"S"}),(0,s.jsx)("div",{className:"staszek-message__bubble",children:e.content})]},a)),m&&(0,s.jsxs)("div",{className:"staszek-message staszek-message--assistant",children:[(0,s.jsx)("div",{className:"staszek-message__avatar",children:"S"}),(0,s.jsxs)("div",{className:"staszek-message__bubble staszek-message__bubble--typing",children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]})]}),(0,s.jsx)("div",{ref:u})]}),c.length<=2&&(0,s.jsx)("div",{className:"staszek-quick",children:["Czym się zajmujecie?","Ile to kosztuje?","Chcę umówić rozmowę"].map((e,a)=>(0,s.jsx)("button",{onClick:()=>(e=>{d(e),setTimeout(()=>{const e=document.querySelector(".staszek-form");e&&e.requestSubmit()},100)})(e),className:"staszek-quick__btn",children:e},a))}),(0,s.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),!r.trim()||m)return;const a=r.trim();d(""),o(e=>[...e,{role:"user",content:a}]),z(!0);try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...c,{role:"user",content:a}]})}),t=await s.json();t.content&&o(e=>[...e,{role:"assistant",content:t.content}])}catch(e){o(e=>[...e,{role:"assistant",content:"Ups, coś poszło nie tak. Spróbuj jeszcze raz lub napisz do nas bezpośrednio."}])}finally{z(!1)}},className:"staszek-input staszek-form",children:[(0,s.jsx)("input",{ref:k,type:"text",value:r,onChange:e=>d(e.target.value),placeholder:"Napisz wiadomość...",disabled:m,className:"staszek-input__field"}),(0,s.jsx)("button",{type:"submit",disabled:m||!r.trim(),className:"staszek-input__send","aria-label":"Wyślij",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]}),(0,s.jsxs)("div",{className:"staszek-footer",children:[(0,s.jsx)("span",{children:"Wolisz rozmowę?"}),(0,s.jsx)("a",{href:a,className:"staszek-footer__link",children:"Umów się z Andrzejem →"})]})]})]})};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".nevo-staszek-chat").forEach(t=>{const n={apiEndpoint:t.dataset.apiEndpoint||"https://n8n.nevomarketing.pl/webhook/staszek-chat",bookingUrl:t.dataset.bookingUrl||"#kontakt",welcomeMessage:t.dataset.welcomeMessage||"Cześć! Jestem Staszek z NEVO. W czym mogę pomóc?",position:t.dataset.position||"bottom-right"};(0,e.createRoot)(t).render((0,s.jsx)(a,{...n}))})})})();